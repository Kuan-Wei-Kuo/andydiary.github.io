{"componentChunkName":"component---src-templates-blog-post-js","path":"/java-concurrency/05/","result":{"data":{"site":{"siteMetadata":{"title":"Andy Diary"}},"markdownRemark":{"id":"7fe40828-3311-5ba1-8630-e7eb3654045f","excerpt":"說來慚愧，儘管年資已老，我卻也不了解 Thread 的生命週期，此次就讓我們了解一下 Thread 生命週期為何。 Thread 有分別 一般而言 Thread 分為 User-thread 以及 Kernel-thread，我們在 Java 中使用的就屬於 User-thread，由 JVM…","html":"<p>說來慚愧，儘管年資已老，我卻也不了解 Thread 的生命週期，此次就讓我們了解一下 Thread 生命週期為何。</p>\n<h2>Thread 有分別</h2>\n<p>一般而言 Thread 分為 User-thread 以及 Kernel-thread，我們在 Java 中使用的就屬於 User-thread，由 JVM 進行管理，接下來讓我們看看差別。</p>\n<h3>User-thread</h3>\n<p>User-thread 是由 Thread library 建立，基本上由應用程式自行管理，也因此 OS 並無法得知 Thread 的存在。舉個例子，當我們想要確認 Thread 狀況，一般而言我們會透過 JConsole 來看看 Thread 運行狀況，因為應用程式內的 Thread 對 OS 來說是不可見的。</p>\n<h3>Kernel-thread</h3>\n<p>Kernel-thread 顧名思義就是由 OS 層建立以及管理的，當然 Kernel level 操作起來是相當複雜的，這邊我也不是專家，就不好說太多了，詳細資訊可能要去讀一下恐龍本以及相關文章才可以了解更加深入。</p>\n<h2>Java thread 生命週期</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.51898734177216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAAB2YuqZBof/8QAGRABAAMBAQAAAAAAAAAAAAAAAgABEgMR/9oACAEBAAEFAutFAr0iwaAIjeHgT//EABYRAQEBAAAAAAAAAAAAAAAAAAAhMf/aAAgBAwEBPwHKr//EABYRAQEBAAAAAAAAAAAAAAAAAAAhYf/aAAgBAgEBPwHVf//EAB0QAAIBBAMAAAAAAAAAAAAAAAABEQIiMnETIUH/2gAIAQEABj8Cu70epEck7ZaUqMjFH//EABsQAQACAwEBAAAAAAAAAAAAAAEAESExUUHx/9oACAEBAAE/IVAEGa2gnRS93O/URUFW25j5hbs+XP/aAAwDAQACAAMAAAAQyO//xAAXEQEBAQEAAAAAAAAAAAAAAAABABFB/9oACAEDAQE/EHpADL//xAAWEQEBAQAAAAAAAAAAAAAAAAABACH/2gAIAQIBAT8Qc1AL/8QAHhABAAMAAQUBAAAAAAAAAAAAAQARIUExUWGxwdH/2gAIAQEAAT8Q5jsSydqjO4oAacZ+xRVsqSniOIGwn3BbTQrStD7Nl0W3PWf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"threadLifeCycle\"\n        title=\"\"\n        src=\"/static/85d3c31cf1764681d214805d860fbdab/828fb/threadLifeCycle.jpg\"\n        srcset=\"/static/85d3c31cf1764681d214805d860fbdab/ff44c/threadLifeCycle.jpg 158w,\n/static/85d3c31cf1764681d214805d860fbdab/a6688/threadLifeCycle.jpg 315w,\n/static/85d3c31cf1764681d214805d860fbdab/828fb/threadLifeCycle.jpg 630w,\n/static/85d3c31cf1764681d214805d860fbdab/e9f84/threadLifeCycle.jpg 672w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\r\n圖片取自於(<a href=\"https://www.geeksforgeeks.org/lifecycle-and-states-of-a-thread-in-java/\">https://www.geeksforgeeks.org/lifecycle-and-states-of-a-thread-in-java/</a>)</p>\n<p>在 Java thread 執行過程中，通常會處在以下任一狀態<br><br>\r\n1. New - 當 Thread 被建立時，其狀態為 New，但 Thread 中的程式碼尚未開始運行。<br><br>\r\n2. Runnable - 準備好可運行時，又或者 Thread 正在運行中，其狀態為 Runnable。由於 thread scheduler 負責進行資源調度，通常會運行一段時間會暫停，將轉換到另外一個 Thread 執行，以此類推。<br><br>\r\n3. Blocked - 如果需要獲取鎖進行排隊時，當會進入該狀態，且其不會占用 CPU 資源。<br><br>\r\n4. Waiting - 如果使用 wait() 方法進行時，即進入該狀態，其不會占用 CPU 資源。<br><br>\r\n5. Timed Waiting - 通常我們使用 Thread.sleep 方法就是屬於 Timed waiting 狀態，並且其不會占用 CPU 資源。<br><br>\r\n6. Terminated - 顧名思義就是執行結束。</p>\n<p>接下來讓我們使用程式碼來玩看看 Java thread 狀態吧!</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Example01</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span> <span class=\"token punctuation\">{</span>\r\n    \r\n    <span class=\"token annotation punctuation\">@Override</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2. Thread State: \"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Example01</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1. Thread State: \"</span> <span class=\"token operator\">+</span> thread<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        thread<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"3. Thread State: \"</span> <span class=\"token operator\">+</span> thread<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n            thread<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"4. Thread State: \"</span> <span class=\"token operator\">+</span> thread<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>運行後結果如下</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">1. Thread State: NEW\r\n2. Thread State: RUNNABLE\r\n3. Thread State: TIMED_WAITING\r\n4. Thread State: TERMINATED</code></pre></div>\n<p>在這邊我們可以看到，在建立 Thread 時，狀態為 New，後續當我們啟動 Thread 時，狀態更改為 Runnable，後續進行 Sleep 可看到 Time waiting 的產生，到最後使用 Join 等待 Thread 執行結束的 Terminated。</p>\n<p>至此我們應該能夠更了解 Thread 的生命週期了。</p>\n<h2>結論</h2>\n<p>這次我們初步的了解 Thread 區分為 User-thread、Kernel-thread，嘗試的使用 Java 建立 Thread 並且控制其狀態。在這邊我們也可以說對 Thread 有一個非常初步的了解。</p>\n<p>不過此次寫這篇文章也僅僅是做個了解，我們常常也僅僅是開開 Thread 卻也沒有去了解，但這種基礎面的東西，可能時間一久就又忘記了，希望這篇文章可以幫助再度遺忘的同行們。</p>\n<h2>參考</h2>\n<p><a href=\"https://chat.openai.com/chat\">https://chat.openai.com/chat</a><br>\r\n<a href=\"https://www.geeksforgeeks.org/difference-between-user-level-thread-and-kernel-level-thread/\">https://www.geeksforgeeks.org/difference-between-user-level-thread-and-kernel-level-thread/</a><br>\r\n<a href=\"https://medium.com/@yovan/os-process-thread-user-kernel-%E7%AD%86%E8%A8%98-aa6e04d35002\">https://medium.com/@yovan/os-process-thread-user-kernel-%E7%AD%86%E8%A8%98-aa6e04d35002</a><br>\r\n<a href=\"https://ithelp.ithome.com.tw/articles/10204372\">https://ithelp.ithome.com.tw/articles/10204372</a><br>\r\n<a href=\"https://medium.com/bucketing/java-concurrency-4-%E5%9F%B7%E8%A1%8C%E7%B7%92%E7%9A%84%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F-thread-lifecycle-6f633bd3089c\">https://medium.com/bucketing/java-concurrency-4-%E5%9F%B7%E8%A1%8C%E7%B7%92%E7%9A%84%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F-thread-lifecycle-6f633bd3089c</a><br>\r\n<a href=\"https://www.geeksforgeeks.org/lifecycle-and-states-of-a-thread-in-java/\">https://www.geeksforgeeks.org/lifecycle-and-states-of-a-thread-in-java/</a></p>","frontmatter":{"title":"Java Concurrency #05 - Thread 的生命週期","date":"2023-04-23","description":null}},"previous":{"fields":{"slug":"/java-concurrency/04/"},"frontmatter":{"title":"Java Concurrency #04 - 如何造成死鎖以及解決方法"}},"next":null},"pageContext":{"id":"7fe40828-3311-5ba1-8630-e7eb3654045f","previousPostId":"1e851418-652a-5a3a-9651-fbd1d4fdd9f8","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}