{"componentChunkName":"component---src-templates-blog-post-js","path":"/elk/要不要來點 ELK - Logstash/","result":{"data":{"site":{"siteMetadata":{"title":"Andy Diary"}},"markdownRemark":{"id":"4ed809a8-82d4-5a6d-a1a8-24d57be47976","excerpt":"什麼是 Logstash ? Logstash 是一個資料處理管道，其從多個來源攝取資料以及轉換，後續將會傳送資料至我們喜歡的存儲位置。 從上述我們也可以切分成三塊，正好是 Logstash 的主要組成，分別為以下: Input: 主要負責接收數據，例如從 Filebeat…","html":"<h2>什麼是 Logstash ?</h2>\n<p>Logstash 是一個資料處理管道，其從多個來源攝取資料以及轉換，後續將會傳送資料至我們喜歡的存儲位置。</p>\n<p>從上述我們也可以切分成三塊，正好是 Logstash 的主要組成，分別為以下:</p>\n<ul>\n<li>Input: 主要負責接收數據，例如從 Filebeat、網路等輸入，其提供的來源真不少，建議大家在建立 Input 時可以去官網看看。</li>\n<li>Filter: 其用途主要用於解析、轉換、過濾等功能。</li>\n<li>Output: 輸出模組主要用於將結果輸出到其他系統或者應用程式中，例如資料庫、搜尋引擎、MessageQueue 等。</li>\n</ul>\n<p>以上就是 Logstash 的簡介，接下來我們來體驗看看，如何將上篇文章中的 Filebeat 進行結合，並且將資料輸出到 Redis 中。</p>\n<h2>搞一下 Redis</h2>\n<p>此次 Redis 作為 ELK 架構中的 Broker，其主要負責緩存資料，避免上下層關係出錯後，導致資料消失。</p>\n<h3>Run redis</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span>\r\n<span class=\"token parameter variable\">-p</span> <span class=\"token number\">6379</span>:6379 <span class=\"token punctuation\">\\</span>\r\nredis</code></pre></div>\n<p>提醒一下，我們 redis 基本上就是預設，在 docker 裡甚至我們沒有處理相關安全性設定，因此記得不要直接這樣上到正式環境。</p>\n<h2>看看 Logstash</h2>\n<p>我們有 Filebeat 也有 Redis 了，接下來我們將 Logstash 當作一個 Shipper 角色，來幫助我們將資料傳遞至 Redis。</p>\n<h3>Step 1. Edit pipeline configuration</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> ./logstash/pipeline\r\n<span class=\"token builtin class-name\">cd</span> ./logstash/pipeline\r\n<span class=\"token function\">vi</span> traefik-shipper-pipeline.config</code></pre></div>\n<p>這邊我們簡單的說明一下步驟: </br>\r\n1. 建立 logstash 與 logstash/pipeline 資料夾，並且進入其中。</br>\r\n2. 編輯 traefik-shipper-pipeline.config 檔案，如下設定。</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">## traefik-shipper-pipeline.config\r\ninput {\r\n  beats {\r\n    port =&gt; &quot;5000&quot;\r\n  }\r\n}\r\n\r\noutput {\r\n  redis {\r\n    data_type =&gt; &quot;list&quot;\r\n\tkey =&gt; &quot;treafik-log&quot;\r\n\thost =&gt; &quot;192.168.144.5&quot;\r\n\tport =&gt; &quot;6379&quot;\r\n  }\r\n}</code></pre></div>\n<p>這個設定檔非常的簡單，讓我來稍微說明:</br>\r\n1. 建立一個 beats input，監聽在 Port-5000。</br>\r\n2. 不進行 Filter，直接將 Output 指向 Redis 裡，並且 Key 為 traefik-log。</p>\n<h3>Step 2. Edit filebeat.yml</h3>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\">## filebeat.yml</span>\r\n<span class=\"token key atrule\">filebeat.inputs</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> log\r\n    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n    <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/home/andy/elk-demo/traefik/logs/access.log*\"</span><span class=\"token punctuation\">]</span>\r\n\r\n<span class=\"token key atrule\">processors</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">add_id</span><span class=\"token punctuation\">:</span> <span class=\"token null important\">~</span>\r\n\r\n<span class=\"token key atrule\">output.logstash</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"192.168.144.5:5000\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>在上一篇文章中，我們 Filebeat 設定輸出至檔案中，這次我們將要正式輸出到 Logstash 上，因此需要修改 Output 位置。</p>\n<h3>Step 3. Run logstash</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5000</span>:5000 <span class=\"token punctuation\">\\</span>\r\n<span class=\"token parameter variable\">-v</span> <span class=\"token environment constant\">$PWD</span>/pipeline:/usr/share/logstash/pipeline:ro <span class=\"token punctuation\">\\</span>\r\nlogstash:7.17.9</code></pre></div>\n<h2>驗證</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5a39fdb70dd3cec1bb4d84daaaf01d2b/2c118/redis_verify.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABJ0AAASdAHeZh94AAAA1ElEQVR42nWQS24DIQxAuf8pepTcoEfovsqIwQYD/lEBSaROmycvwPKzMSHGSEQ+vBSSifXOzN3M/D0i2lnDLjKz2toYevsaH5/+jTbGcB/v2C3CcRwxnjsAAKreoYs6M9vG/RXurmqt824bzNR+ob4yZZFzfh5KKUREjSU35SWFy3v0yTYBMS8TMe9GtXPp2mXWXGUR2XJaxBhTSmdK5zmvCECNoWpjtb8y80NGnGNTAkAEwATzgJipMS75n8kzt76hFHqsSpWorn2Jam0sxDYHm/0AIvjTdxtZLGUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redis_verify\"\n        title=\"\"\n        src=\"/static/5a39fdb70dd3cec1bb4d84daaaf01d2b/f058b/redis_verify.png\"\n        srcset=\"/static/5a39fdb70dd3cec1bb4d84daaaf01d2b/c26ae/redis_verify.png 158w,\n/static/5a39fdb70dd3cec1bb4d84daaaf01d2b/6bdcf/redis_verify.png 315w,\n/static/5a39fdb70dd3cec1bb4d84daaaf01d2b/f058b/redis_verify.png 630w,\n/static/5a39fdb70dd3cec1bb4d84daaaf01d2b/40601/redis_verify.png 945w,\n/static/5a39fdb70dd3cec1bb4d84daaaf01d2b/78612/redis_verify.png 1260w,\n/static/5a39fdb70dd3cec1bb4d84daaaf01d2b/2c118/redis_verify.png 1505w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>我們接下來登入 Redis manager 即可看到 traefik-log key 以及其內部資料，這也代表說我們的設定成功了。</p>\n<h2>結論</h2>\n<p>其實大家可以看到目前設定很簡單，因為此次設定僅僅是想讓 Filebeat 過一下 Logstash 罷了，其實 Filebeat 可以直接傳送資料至 Redis。因此在正式環境時，大家還是得按照業務情境進行設計，會有比較好的結果。</p>\n<p>在下一篇張，我們將嘗試進行 Logstash indexer 與 Elasticsearch 以及 Kibina 的互動，讓我們結束此次 ELK 體驗之旅吧!</p>\n<h2>參考</h2>\n<p><a href=\"https://chat.openai.com/chat\">https://chat.openai.com/chat</a></br>\r\n<a href=\"https://www.elastic.co/logstash/\">https://www.elastic.co/logstash/</a></p>","frontmatter":{"title":"要不來點 ELK - Logstash(Shipper)","date":"2023-03-13","description":null}},"previous":{"fields":{"slug":"/elk/要不要來點 ELK - Filebeat/"},"frontmatter":{"title":"要不來點 ELK - Filebeat"}},"next":null},"pageContext":{"id":"4ed809a8-82d4-5a6d-a1a8-24d57be47976","previousPostId":"994eb191-3614-526d-9a93-7ac54dcd4dee","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}