{"componentChunkName":"component---src-templates-blog-post-js","path":"/SpringBootTest 如何跳過 @Configuration/","result":{"data":{"site":{"siteMetadata":{"title":"Andy Diary"}},"markdownRemark":{"id":"033928fa-b884-5291-9f3d-914c35f5d226","excerpt":"Introduction 最近在撰寫整合測試時，在思考有沒有辦法加快整合測試的速度，當然首當其衝的就是，當某些測試不需要 Redis、MQ 連線時，全部略過啟用，可是查了許多資料，安迪我真的找不到一個簡單的方式，接下來就讓我分享一下我是如何跳過 @Configuration 的自動載入。 Solution…","html":"<h2>Introduction</h2>\n<p>最近在撰寫整合測試時，在思考有沒有辦法加快整合測試的速度，當然首當其衝的就是，當某些測試不需要 Redis、MQ 連線時，全部略過啟用，可是查了許多資料，安迪我真的找不到一個簡單的方式，接下來就讓我分享一下我是如何跳過 @Configuration 的自動載入。</p>\n<h2>Solution</h2>\n<p>今天我們有一個 MyService 服務要進行測試，但在 SpringBootTest 的情況下，會自動載入相關 @Configuration，如果安迪不想讓 MQTT 在測試時也嘗試連線，我們應該如何使用。</p>\n<p>首先我們需要建立一個 TestMqttConfiguraion</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@TestConfiguration</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestMqttConfiguration</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token annotation punctuation\">@MockBean</span>\r\n    <span class=\"token class-name\">MessageProducer</span> inbound<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>上述實際用途就是相 MQTT 中的啟動入口利用 @MockBean 覆蓋，讓其略過啟動。</p>\n<p>接下來我們可以看看 MyService 應該如何撰寫。</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@SpringBootTest</span>\r\n<span class=\"token annotation punctuation\">@AutoConfigureTestDatabase</span><span class=\"token punctuation\">(</span>connection <span class=\"token operator\">=</span> <span class=\"token class-name\">EmbeddedDatabaseConnection</span><span class=\"token punctuation\">.</span><span class=\"token constant\">H2</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token annotation punctuation\">@Import</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TestMqttConfiguration</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyServiceTests</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token comment\">// do something...</span>\r\n\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>這邊可以看到我們 Import 剛剛建立的 TestMqttConfiguration，其實今天將 TestMqttConfiguration 內的 MessageProducer 放到這邊進行 @MockBean 也是行得通，概念上是一樣的，只是我們專門建立一個 Class 可以讓後續其他也需要略過啟動的測試可以一起使用。</p>\n<h2>Review</h2>\n<p>目前這個方法網路上有不少的答案，但有時候並沒有說明清除，其根本思路就是利用 @MockBean 方式來跳過某些 @Configuraion 所需要的 Bean 以此來達到不啟用的動作。</p>","frontmatter":{"title":"SpringBootTest 如何跳過 @Configuration","date":"2023-08-25","description":null}},"previous":{"fields":{"slug":"/前後端分離攜帶 Cookie 的跨域問題/"},"frontmatter":{"title":"前後端分離攜帶 Cookie 的跨域問題"}},"next":{"fields":{"slug":"/淺談負載均衡 Webscoket 消息共享問題/"},"frontmatter":{"title":"淺談負載均衡 Webscoket 消息共享問題"}}},"pageContext":{"id":"033928fa-b884-5291-9f3d-914c35f5d226","previousPostId":"6d4c43db-6bc1-584e-a535-48e30600edab","nextPostId":"5989e371-09fd-59cc-8a75-2f81f794dce6"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}