{"componentChunkName":"component---src-templates-blog-post-js","path":"/【Java】談談 Stack 與 Heap 的生活/","result":{"data":{"site":{"siteMetadata":{"title":"Andy Diary"}},"markdownRemark":{"id":"6843c007-669c-58ec-ab6a-ee631f0fde0a","excerpt":"在 JAVA 中管理記憶管理分為兩部分，分別為 Stack 與 Heap，各自有著不同的負責項目，也需要相互合作，接下來就讓我們探討兩者之前的差別。 Stack Memory 在 JVM 中 Stack 儲存順序為後進先出(LIFO)，每個 thraed 都維護著自有的 Stack…","html":"<p>在 JAVA 中管理記憶管理分為兩部分，分別為 Stack 與 Heap，各自有著不同的負責項目，也需要相互合作，接下來就讓我們探討兩者之前的差別。</p>\n<h2>Stack Memory</h2>\n<p>在 JVM 中 Stack 儲存順序為後進先出(LIFO)，每個 thraed 都維護著自有的 Stack 區塊，其負責儲存變數、物件參照、函式等等。</p>\n<p>現在我們來說說函式，每當我們調用一個函式時，都將在 Stack 中建立一個區塊，此區塊負責儲存上述所說明的項目，然而分配的記憶體會一直存在，直到函式完成執行。倘若函式一直無法返回結果，記憶體用量無限增生，此時就會發出 StackOverFlowError，這也是在撰寫遞迴時常看見的錯誤訊息。</p>\n<h2>Heap Memory</h2>\n<p>說到 Heap 就不得不說 OutOfMemoryError，這也是我們常常遇到的錯誤訊息，也因為 Heap 主要負責儲存物件以及 JRE 相關類別，因此設計大量資料運算時，常常我們需要考慮記憶體用量，並且使用批次進行計算，盡量讓物件達成 GC 回收的前置作業，以免發生 OOM 錯誤。</p>\n<p>而開頭說明 Stack 與 Heap 會互相合作，其實就是由 Stack 負責儲存物件參照位置，Heap 負責使用參照位置進行儲存物件資料，由 JVM 自行管理其運作關係。</p>\n<h2>範例</h2>\n<p>接下來我們簡單的設計一個範例，基本上就是從 main 方法中進行 Product 物件的建立。</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Product</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\r\n    <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> id <span class=\"token operator\">=</span> <span class=\"token number\">69</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"Milk\"</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token class-name\">Product</span> product <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> namn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>讓我們一步步地分析:</p>\n<ol>\n<li>main() 函式被調用，將在 Stack 分配區塊進行儲存該方法與相關變數。</li>\n<li>Stack 直接儲入整數 id 的原始值。</li>\n<li>Heap 分配 String pool 區塊，將字串 name 進行儲存，並且 Stack 儲存其參照位置。</li>\n<li>從 main() 函式調用 Product(int, String)， Heap 將儲存 Stack 中的 id 與 name，最終創立 Prodcut 類別並由 Stack 儲存其參照位置。</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 473px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9fafbfca135aa3a7bddae939033980dd/c7c3c/Stack_Heap_Example.drawio.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.87341772151898%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACu0lEQVR42oWUaW/aQBCG+f8/o1I+VFXVhBTCGcJlbkPNFYWjEC4VbK/tPUwS0FvtcqdRutIrj2dmH+/sjjeAD8bLywu22y0+G6+vr0rvR2Cz2ajA29ubkrSn0yk8z8N57ACQkh8jhGC5XGKz3R79Mj/AGFNB13XhOI56Stjh/eCzLEuJUQrXIVgs5pjPZiC2DcaoYkhWgHOuDCEEpP2RZExCKaVYWgSPw2fozS5qRgfd/hiLpXXMVUCZeAB/JBkjxIFgDN3hFMGMjkS5g0Slg9tsHUXjCb7gpxVKIPsPUJZOqYdKq4dosYlgqoTr+wIiBQOVdv9foCxLCH4mceGTJdu2jZzewZ1mIJyt4y7bQCjXQKX1DuhRCst2YNoOVjaBSRysLKIkfdTbHdzKNNEbzxDVDMSrBu4qOmKFJmqdwR7IERCcw/U8xLQ6roJJfA2ncXWTwPdYHt+iOXy5jqM9GqrVmZa923wqMGcLDNgQPvVBGT2eww7ouqi1+8jqHeTrXSVZWqbWRrbWQXsywGQ1A/V2kwQX8LgLwomyzw92D/QU7Ec8j9tUETdJDZF8HXc5HTfJAjq9MebeDMQluxUyDsIIlmwFwQQYZycg3wOr7T4SWh2pUgPJgo50pYV0tYW4pmM8+wOXOpi6M6yFD58LUN8DWRP1frlCweG4LorNJ4QzFYTTZUSyVdyXW4jkdITSZfTHU3DKsGJLpMZlJLQWQpkSgqkColoD9ceh6oTdoeyBBeMJt6mSKjd4X0BMa6iSfz5I4Ez1oJQxGiCq/ULooYTQQ1nZF8DDciljqn1+j0boDwbo9Xqqmdn+l5K253oQzFd5z5MJRuOx2i7Zfxd7ePiXxb45T75Tkx8ujfOGP80Tx3kBSX5/2xzkOCefaZrqtjndQu7FHMmQrIC8x3zfx3q9/lQy57M8GZOsv8mzPyaPEYqrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Stack_Heap_Example.drawio\"\n        title=\"\"\n        src=\"/static/9fafbfca135aa3a7bddae939033980dd/c7c3c/Stack_Heap_Example.drawio.png\"\n        srcset=\"/static/9fafbfca135aa3a7bddae939033980dd/c26ae/Stack_Heap_Example.drawio.png 158w,\n/static/9fafbfca135aa3a7bddae939033980dd/6bdcf/Stack_Heap_Example.drawio.png 315w,\n/static/9fafbfca135aa3a7bddae939033980dd/c7c3c/Stack_Heap_Example.drawio.png 473w\"\n        sizes=\"(max-width: 473px) 100vw, 473px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>參考</h2>\n<p><a href=\"https://www.javatpoint.com/stack-vs-heap-java\">https://www.javatpoint.com/stack-vs-heap-java</a><br>\r\n<a href=\"https://www.baeldung.com/java-stack-heap\">https://www.baeldung.com/java-stack-heap</a><br>\r\n<a href=\"https://stackify.com/java-heap-vs-stack/\">https://stackify.com/java-heap-vs-stack/</a></p>","frontmatter":{"title":"【Java】談談 JVM 的 Stack 與 Heap","date":"2023-02-10","description":null}},"previous":{"fields":{"slug":"/leetcode/【LeetCode】 1115.  Print FooBar Alternately/"},"frontmatter":{"title":"【LeetCode】 1115.  Print FooBar Alternately"}},"next":null},"pageContext":{"id":"6843c007-669c-58ec-ab6a-ee631f0fde0a","previousPostId":"2a474575-fb55-53d4-b781-fddd161e47b6","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}